<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- facilityMapper.xml -->
<mapper namespace="com.itwillbs.mapper.FacilityMapper">
	<resultMap type="com.itwillbs.domain.FacilityVO"
		id="facility">
		<result property="code" column="code" />
		<result property="category" column="category" />
		<result property="name" column="name" />
		<result property="model" column="model" />
		<result property="purchase_date" column="purchase_date" />
		<result property="inprice" column="inprice" />
		<result property="location" column="location" />
		<result property="line_code" column="line_code" />
		<result property="uph" column="uph" />
		<result property="image" column="image" />
		<result property="active" column="active" />
	</resultMap>

	<sql id="facilitySearch">
		<where>
			<![CDATA[code = code ]]>
			<if test="search eq null">
				<![CDATA[AND active = TRUE ]]>
			</if>
			<if test="search neq null">
				<!-- 라디오 -->
				<if test="search.formRadio eq null">
				<![CDATA[AND active = TRUE ]]>
				</if>
				<if test="search.formRadio neq null">
					<choose>
						<when test="search.formRadio.toString() eq 'true'">
							<![CDATA[AND active = TRUE ]]>
						</when>
						<when test="search.formRadio.toString() eq 'false'">
							<![CDATA[AND active = FALSE ]]>
						</when>
					</choose>
				</if>
				<!-- 라디오 -->
				<!-- 기본 검색 -->
				<if test="search.searchKeyword neq null">
					<choose>
						<when test="search.searchCategory.toString() eq null">
							<![CDATA[
								AND (code LIKE '%'||#{search.searchKeyword}||'%' OR 
								name LIKE '%'||#{search.searchKeyword}||'%' OR 
								model LIKE '%'||#{search.searchKeyword}||'%' OR 
								location LIKE '%'||#{search.searchKeyword}||'%' OR 
								line_code LIKE '%'||#{search.searchKeyword}||'%'
								) 
							]]>
						</when>
						<when test="search.searchCategory.toString() eq 'code'">
							<![CDATA[
								AND code LIKE '%'||#{search.searchKeyword}||'%' 
							]]>
						</when>
						<when test="search.searchCategory.toString() eq 'name'">
							<![CDATA[
								AND name LIKE '%'||#{search.searchKeyword}||'%' 
							]]>
						</when>
						<when test="search.searchCategory.toString() eq 'model'">
							<![CDATA[
								AND model LIKE '%'||#{search.searchKeyword}||'%' 
							]]>
						</when>
						<when test="search.searchCategory.toString() eq 'location'">
							<![CDATA[
								AND location LIKE '%'||#{search.searchKeyword}||'%' 
							]]>
						</when>
						<when test="search.searchCategory.toString() eq 'line_code'">
							<![CDATA[
								AND line_code LIKE '%'||#{searchKeyword}||'%' 
							]]>
						</when>
					</choose>
				</if>
				<!-- 기본 검색 -->
				<!-- check box -->
				<if test="search.formCheck neq null">
				<![CDATA[AND category IN]]>
					<foreach collection="search.formCheck" item="item"
						index="index" open="(" close=")" separator=",">
						#{item}
					</foreach>
				<![CDATA[) ]]>
				</if>
				<!-- check box -->
				<!-- date -->
				<if test="search.date neq null">
				<![CDATA[
					AND purchase_date = #{search.date}
				]]>
				</if>
				<!-- date -->
				<!-- date between -->
				<if test="search.betweenDateLeft neq null and search.betweenDateRight neq null">
					<![CDATA[
					AND purchase_date BETWEEN
					#{search.betweenDateLeft} AND
					#{search.betweenDateRight}
					]]>
				</if>
				<!-- date between -->
			</if>
			<!-- searchVO not null -->
		</where>
	</sql>

	<!-- 입력 -->
	<insert id="insertFacility">

	</insert>

	<!-- 개수 계산 -->
	<select id="getFacilityCount" resultType="int">
		<![CDATA[	
		SELECT count(*) FROM FAC_INFO 
		]]>
		<include refid="facilitySearch" />
	</select>

	<select id="getFacilityList"
		resultType="com.itwillbs.domain.FacilityVO" resultMap="facility">
		<![CDATA[
		SELECT * FROM FAC_INFO
		]]>
		<include refid="facilitySearch" />
		<![CDATA[
		ORDER BY code DESC 
		LIMIT #{cri.page}, #{cri.pageSize}
		]]>
	</select>
</mapper>