<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  
  <!--orderMapper.xml -->
  <mapper namespace="com.itwillbs.mapper.OrderMapper">
  
  	<resultMap type="com.itwillbs.domain.OrderVO" id="order">
		<result property="code" column="code"/>
		<result property="material" column="material"/>
		<result property="date" column="date"/>
		<result property="client_code" column="client_code"/>
		<result property="amount" column="amount"/>
		<result property="complete" column="complete"/>
		<result property="order_date" column="order_date"/>
		<result property="reg_date" column="reg_date"/>
		<result property="reg_emp" column="reg_emp"/>
		<result property="update_date" column="update_date"/>
		<result property="update_emp" column="update_emp"/>
		<result property="status" column="status"/>
		<result property="name" column="name"/>
		<result property="category" column="category"/>
	</resultMap>

	
	<!-- 발주 목록, 발주 검색 -->
	<select id="selectOrderList" parameterType="hashMap" resultMap="order">
    	SELECT o.code,o.material,o.date,
    	FROM ORDERS o
    	JOIN CLIENT c
    	ON o.client_code=c.code
    	JOIN EMPLOYEES e1
    	ON o.reg_emp=e1.code
    	JOIN EMPLOYEES e2
    	ON o.update_emp=e2.code
		<where>
			<if test="searchOrder != null or searchMapd != null">
			<if test="searchOrder != null">
				code LIKE CONCAT('%', #{searchOrder}, '%')
			</if>
			<if test="searchOrder != null and searchMapd != null">
				AND
			</if>
			<if test="searchMapd != null">
				material LIKE CONCAT('%', #{searchMapd}, '%')
			</if>
			</if>
    	</where>
    	<!-- ORDER BY CAST(SUBSTRING(code, 4) AS UNSIGNED) DESC -->	<!-- 코드 정하면 바꾸기 -->
    	LIMIT #{cri.startPage}, #{cri.pageSize}
	</select>

	<!-- 모든 발주 수 -->
	<select id="countOrder" parameterType="hashMap" resultType="int">
		SELECT count(*) 
		FROM ORDERS
		<where>
			<if test="searchOrder != null or searchMapd != null">
			<if test="searchOrder != null">
				code LIKE CONCAT('%', #{searchOrder}, '%')
			</if>
			<if test="searchOrder != null and searchMapd != null">
				AND
			</if>
			<if test="searchMapd != null">
				material LIKE CONCAT('%', #{searchMapd}, '%')
			</if>
			</if>
		</where>
	</select>
	
	<!-- 품목 검색 팝업 -->
	<select id="SearchMAPD" parameterType="hashMap" resultMap="order">
		SELECT code, category, name
		FROM MAPD
		<where>	
			<if test="mapdCode != null or mapdName != null">
			<if test="mapdCode != null">
				code LIKE CONCAT('%', #{mapdCode}, '%')
			</if>
			<if test="mapdCode != null and mapdName != null">
				AND
			</if>
			<if test="mapdName != null">
				name LIKE CONCAT('%', #{mapdName}, '%')
			</if>
			</if>
		</where> 
    	LIMIT #{cri.startPage}, #{cri.pageSize}
	</select>	
	
	<!-- 모든 품목 수 -->
	<select id="countMAPD" parameterType="hashMap" resultType="int">
		SELECT count(*) 
		FROM MAPD
		<where>	
			<if test="mapdCode != null or mapdName != null">
			<if test="mapdCode != null">
				code LIKE CONCAT('%', #{mapdCode}, '%')
			</if>
			<if test="mapdCode != null and mapdName != null">
				AND
			</if>
			<if test="mapdName != null">
				name LIKE CONCAT('%', #{mapdName}, '%')
			</if>
			</if>
		</where>
	</select>
 
 	<!-- 발주 삭제 -->
	<select id="getDelInfo" resultMap="order">
		SELECT *
    	FROM ORDERS
		WHERE code IN
		<foreach collection="code_arr" item="item" open="(" close=")" separator=",">
			#{item}
		 </foreach>
	</select>
	
	<delete id="deleteOrder" parameterType="hashmap">
		DELETE FROM ORDERS WHERE code IN
		<foreach collection="code_arr" item="item" open="(" close=")" separator=",">
			#{item}
		</foreach>
	</delete> 
  
  
  
  
  
  
  </mapper>