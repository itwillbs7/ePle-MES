<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  
    <!--stockMapper.xml -->
  <mapper namespace="com.itwillbs.mapper.StockMapper">
  
  	<resultMap type="com.itwillbs.domain.StockVO" id="stock">
		<result property="stock_code" column="code"/>
		<result property="warehouse_code" column="warehouse_code"/>
		<result property="mapd_code" column="mapd_code"/>
		<result property="amount" column="amount"/>
		<result property="group_id" column="group_id"/>
		<result property="code_id" column="code_id"/>
		<result property="wh_code" column="code"/>
		<result property="wh_name" column="name"/>
	</resultMap>
	
	
	
		<!--  -->
	<select id="selectStockList" parameterType="hashMap" resultMap="stock">
    	SELECT w.code, w.location, w.group_id, w.group_name, e.code, e.name, e.phone, w.active
    	FROM STOCK s 
    	JOIN WAREHOUSE w ON s.warehouse_code = w.code
    	JOIN MAPD m ON s.mapd_code = w.code
		<where>
			<if test="searchCode != null or searchName != null">
			<if test="searchCode != null">
				w.code LIKE CONCAT('%', #{searchCode}, '%')
			</if>
			<if test="searchCode != null and searchName != null">
				AND
			</if>
			<if test="searchName != null">
				e.code LIKE CONCAT('%', #{searchName}, '%')
			</if>
			</if>
    	</where>
    	ORDER BY CAST(SUBSTRING(w.code, 4) AS UNSIGNED) DESC	<!-- 코드 정하면 수정하기 -->
    	LIMIT #{cri.startPage}, #{cri.pageSize}
	</select>
	
	
	
	
	
	</mapper>